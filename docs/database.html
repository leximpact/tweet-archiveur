---

title: Database for tweets storage


keywords: fastai
sidebar: home_sidebar

summary: "Use PostgreSQL to store tweets"
description: "Use PostgreSQL to store tweets"
nb_path: "notebooks/05_database.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: notebooks/05_database.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-03-20 14:33:36,927 -  tweet-archiveur INFO     Loading database module...
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-03-20 12:10:20,375 -  tweet-archiveur INFO     Loading database module...
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="database_config" class="doc_header"><code>database_config</code><a href="https://github.com/leximpact/tweet-archiveur/tree/main/tweet_archiveur/database.py#L48" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>database_config</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="database_url" class="doc_header"><code>database_url</code><a href="https://github.com/leximpact/tweet-archiveur/tree/main/tweet_archiveur/database.py#L52" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>database_url</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="db_connect" class="doc_header"><code>db_connect</code><a href="https://github.com/leximpact/tweet-archiveur/tree/main/tweet_archiveur/database.py#L69" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>db_connect</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="exec_query" class="doc_header"><code>exec_query</code><a href="https://github.com/leximpact/tweet-archiveur/tree/main/tweet_archiveur/database.py#L75" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>exec_query</code>(<strong><code>conn</code></strong>, <strong><code>sql</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="create_tables_if_not_exist" class="doc_header"><code>create_tables_if_not_exist</code><a href="https://github.com/leximpact/tweet-archiveur/tree/main/tweet_archiveur/database.py#L97" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>create_tables_if_not_exist</code>(<strong><code>conn</code></strong>, <strong><code>force</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="insert_pandas" class="doc_header"><code>insert_pandas</code><a href="https://github.com/leximpact/tweet-archiveur/tree/main/tweet_archiveur/database.py#L162" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>insert_pandas</code>(<strong><code>conn</code></strong>, <strong><code>table</code></strong>, <strong><code>df</code></strong>, <strong><code>fields</code></strong>, <strong><code>prevent_conflict</code></strong>=<em><code>True</code></em>, <strong><code>delete_where</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Using cursor.mogrify() to build the bulk insert query
then cursor.execute() to execute the query
Thanks to <a href="https://naysan.ca/2020/05/09/pandas-to-postgresql-using-psycopg2-bulk-insert-performance-benchmark/">https://naysan.ca/2020/05/09/pandas-to-postgresql-using-psycopg2-bulk-insert-performance-benchmark/</a></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="filter_str" class="doc_header"><code>filter_str</code><a href="https://github.com/leximpact/tweet-archiveur/tree/main/tweet_archiveur/database.py#L210" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>filter_str</code>(<strong><code>s</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="insert_twitter_users" class="doc_header"><code>insert_twitter_users</code><a href="https://github.com/leximpact/tweet-archiveur/tree/main/tweet_archiveur/database.py#L216" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>insert_twitter_users</code>(<strong><code>conn</code></strong>, <strong><code>df</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="insert_tweets" class="doc_header"><code>insert_tweets</code><a href="https://github.com/leximpact/tweet-archiveur/tree/main/tweet_archiveur/database.py#L230" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>insert_tweets</code>(<strong><code>conn</code></strong>, <strong><code>df</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="insert_hashtags" class="doc_header"><code>insert_hashtags</code><a href="https://github.com/leximpact/tweet-archiveur/tree/main/tweet_archiveur/database.py#L247" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>insert_hashtags</code>(<strong><code>conn</code></strong>, <strong><code>df</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

